version: 2
jobs:
  build:
    machine: true
    steps:
      - checkout
      - run:
          name: Setup goss & dgoss
          command: |
            curl -L https://github.com/aelsabbahy/goss/releases/download/v0.3.6/goss-linux-amd64 -o ${HOME}/bin/goss
            chmod +x ${HOME}/bin/goss
            export GOSS_PATH=${HOME}/bin/goss
            curl -L https://raw.githubusercontent.com/aelsabbahy/goss/master/extras/dgoss/dgoss -o ${HOME}/bin/dgoss
            chmod +x ${HOME}/bin/dgoss
      - run:
          name: Create Temporary Image
          command: |
            docker build -t temporary:httpd . 
      - run:
          name: Run Tests
          command: |
            # dgoss run temporary:httpd httpd -g "daemon off;"
            dgoss run temporary:httpd /usr/sbin/httpd -DFOREGROUND
          #      - setup_remote_docker:
          #          docker_layer_caching: true
          #      - run:
          #          name: Build and push Docker image
          #          command: |
          #            docker build -t inokappa/$IMAGE_NAME:$TAG .
          #            echo $DOCKER_PWD | docker login -u $DOCKER_LOGIN --password-stdin
          #            docker push inokappa/$IMAGE_NAME:$TAG
